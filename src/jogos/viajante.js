//const prompt = require("prompt-sync")();
//const chalk = require('chalk');
import chalk from "chalk";
import { console, prompt, process, rl } from "../mockConsole";

export async function viajante() {

var firsttime = true;
var firsttime2 = false;
var firsttime3 = true;
var firsttime4 = false;
var firsttime5 = false;
var firsttime6 = false;
var firsttime7 = false;
var nome;
var alldiag = 0;
var combustivel = false;
var motor = false;
var cambio = false;
var carda = false;
var finalscene = true;
var firstposto = true;
var horafinal = true;

const cenarios = {
    menu: {
        descricao: () => {
            return console.log("Seja bem-vindo ao jogo O Tempo do Viajante! ðŸ§­" +
                "\nBora jogar!");
        },
        conexoes: {
            "jogar": () => {
                console.clear();
                return "scania";
            },
            "criadores": () => {
                console.clear();
                return "creditos";
            }
        }
    },
    creditos: {
        descricao: () => {
            console.log("Criado com esforÃ§o por Gabriela e Leonardo. ðŸš›");
        },
        conexoes: {
            "voltar": () => {
                console.clear();
                return "menu";
            }
        }
    },
    scania: {
        descricao: () => {
            if (firsttime) {
                console.log(chalk.italic("*Este jogo se trata de um caminhoneiro " +
                    "que realiza uma entrega de produtos a um determinado" +
                    " destino,\nmas quando menos se espera...*\n\n") +
                    "Vish! Calculei errado a prÃ³xima parada, deveria ter" +
                    "passado no Ãºltimo posto de gasolina!" +
                    chalk.italic("\n\n*Seu caminhÃ£o parou de funcionar no meio da estrada*"));
            } else if (firsttime == false && firsttime4 == true) {
                console.log(chalk.italic("*VocÃªs retornaram ao seu caminhÃ£o.*"));
                console.log("Ok! Esse deve ser o seu caminhÃ£o, me aparece solÃºvel e nÃ£o hÃ¡ a necessidade de retornar Ã  mecÃ¢nica.");
                console.log("Viajante " + nome + ", eu irei fazer o diagnÃ³stico vocÃª pode ficar ao lado para consultar: ");
                firsttime4 = false;
            }
        },
        conexoes: {
            "ver a hora": () => {
                firsttime = false;
                console.clear();
                if (horafinal == true) {
                    console.log(chalk.italic("*HorÃ¡rio Ã© 1:03PM agora, um dia normal.*"));
                } else {
                    console.log(chalk.italic("*HorÃ¡rio Ã© 5:15PM agora, uma tardezinha confortÃ¡vel.*"));
                }
                return "scania";
            },
            "sair do veiculo": () => {
                firsttime = false;
                console.clear();
                console.log("VocÃª saiu do veÃ­culo!");
                return "fora";
            },
            "dirigir": () => {
                console.clear();
                console.log(chalk.green("ParabÃ©ns, viajante! A histÃ³ria do jogo estÃ¡ concluÃ­da."));
                firsttime = true;
                firsttime2 = false;
                firsttime3 = true;
                firsttime4 = false;
                firsttime5 = false;
                firsttime6 = false;
                firsttime7 = false;
                nome = "";
                alldiag = 0;
                combustivel = false;
                motor = false;
                cambio = false;
                carda = false;
                finalscene = true;
                firstposto = true;
                horafinal = true;
                return "menu"
            }
        }
    },
    fora: {
        descricao: () => {
            if (firsttime6 == false) {
                console.log(chalk.italic("*Preciso retornar ao Ãºltimo posto de gasolina, estÃ¡ vazando Ã³leo...*"));
            } else if (firsttime7 == false) {
                console.log("Ok! Vamos solucionar! " + chalk.italic("*Disse o mecÃ¢nico.*"));
                firsttime7 = true;
            } else {
                console.log(chalk.italic("*Agora que estÃ¡ tudo finalizado, vamos voltar para a estrada!*"));
                finalscene = false;
            }
        },
        conexoes: {
            "N": () => {
                console.clear();
                return "outroLadoEstrada"
            },
            "L": () => {
                console.clear();
                return "frenteEstrada"
            },
            "O (voltar ao posto)": () => {
                console.clear();
                return "posto"
            },
            "entrar no veiculo": () => {
                console.clear();
                console.log(chalk.italic("*VocÃª entrou em seu veÃ­culo!*"));
                return "scania"
            },
            "diagnostico": () => {
                console.clear();
                console.log("Viajante " + nome + ", eu irei fazer o diagnÃ³stico vocÃª pode ficar ao lado para consultar.");
                return "diagnostico"
            }
        }
    },
    diagnostico: {
        descricao: () => {
            console.log("Escolha o que vocÃª gostaria de inspecionar:");
        },
        conexoes: {
            "checar o combustivel": () => {
                console.clear();
                combustivel = true;
                console.log("Tudo ok com o sistema de abastecimento. O nÃ­vel estÃ¡ dentro do esperado e nÃ£o hÃ¡ sinais de impurezas.");
                alldiag++;
                if (alldiag == 4) {
                    return "fix"
                } else {
                    return "diagnostico"
                }
            },
            "verificar o motor": () => {
                console.clear();
                motor = true;
                console.log("O motor estÃ¡ falhando por causa de velas desgastadas e excesso de carbonizaÃ§Ã£o nos pistÃµes. Por causa disso surge o vazamento de Ã³leo.");
                alldiag++;
                if (alldiag == 4) {
                    return "fix"
                } else {
                    return "diagnostico"
                }
            },
            "checar a caixa de cambio": () => {
                console.clear();
                cambio = true;
                console.log("Tudo ok. As trocas estÃ£o suaves, sem ruÃ­dos ou vazamentos aparentes.");
                alldiag++;
                if (alldiag == 4) {
                    return "fix"
                } else {
                    return "diagnostico"
                }
            },
            "checar o carda": () => {
                console.clear();
                carda = true;
                console.log("Tudo ok. Sem folgas ou desgaste nas juntas. Funcionamento estÃ¡vel.");
                alldiag++;
                if (alldiag == 4) {
                    return "fix"
                } else {
                    return "diagnostico"
                }
            }
        }
    },
    fix: {
        descricao: () => {
            console.log("Bem, para isso substituirei as velas de igniÃ§Ã£o e realizarei uma\n limpeza nos pistÃµes para remover a carbonizaÃ§Ã£o. Depois disso, troca as juntas \n para conter o vazamento de Ã³leo. Ok?");
        },
        conexoes: {
            "ok": () => {
                console.clear();
                console.log(chalk.italic("*Agora estÃ¡ finalizado, pronto para voltar ao meu trabalho.*"));
                return "finalizado"
            }
        }
    },
    finalizado: {
        descricao: () => {

        },
        conexoes: {
            "muito obrigado, mao de broca": () => {
                console.clear();
                console.log("De nada, meu viajante " + nome + "! Pode voltar ao seu trabalho e, lembre-se, o motor clama por reparos antes que o tempo o condene Ã  ferrugem eterna");
                return "fora"
            }
        }
    },
    frenteEstrada: {
        descricao: () => {
            console.log("Esse Ã© o horizonte que eu passarei... caso " +
                chalk.bold("volte a funcionar o caminhÃ£o."));
        },
        conexoes: {
            "O": () => {
                console.clear();
                console.log("O nosso bom e velho caminhÃ£o estÃ¡ parado aqui na estrada.");
                return "fora"
            }
        }
    },
    outroLadoEstrada: {
        descricao: () => {
            console.log("NÃ£o hÃ¡ nada por aqui pelo outro lado da estrada!");
        },
        conexoes: {
            "S": () => {
                console.clear();
                console.log("O nosso bom e velho caminhÃ£o estÃ¡ parado aqui na estrada.");
                return "fora"
            }
        }
    },
    posto: {
        descricao: () => {
            if (firstposto == true) {
                console.log("VocÃª decide, com determinaÃ§Ã£o, voltar ao Ãºltimo " +
                    "posto de gasolina a pÃ©. Passa-se 4 horas direto e vocÃª \n" +
                    "chegou ao seu destino temporÃ¡rio.");
            } else {
                console.log("Finalmente eu estou no posto!");
            }
        },
        conexoes: {
            "frentista": () => {
                console.clear();
                console.log(chalk.italic("*HÃ¡ um frentista, vocÃª pode conversar com ele para poder resolver*"));
                firstposto = false;
                return "frentista"
            }
        }
    },
    frentista: {
        descricao: () => {
            console.log("OlÃ¡! Meu nome Ã© Elias, como posso lhe ajudar? ðŸ˜…");
        },
        conexoes: {
            "continuar": () => {
                console.clear();
                return "continuar"
            },
            "sair": () => {
                console.clear();
                console.log("Tenha um bom dia, viajante! ðŸ˜ƒ");
                firsttime2 = true;
                return "posto"
            }
        }
    },
    continuar: {
        descricao: () => {
            if (firsttime2 == false) {
                console.log("Deu problema no seu caminhÃ£o? ðŸ˜§ Ele estÃ¡ longe? ðŸ˜¨ Bem, converse " +
                    "com o nosso mecÃ¢nico aqui ao lado para \npuxar com guincho, ele Ã© conhecido como 'mÃ£o de broca'. ðŸ¤ ");
                firsttime2 = true;
            } else if (firsttime2 == true) {
                console.log("VocÃª necessita de ir ao mecÃ¢nico, meu viajante! ðŸ˜Š");
            }
        },
        conexoes: {
            "ir para a mecanica": () => {
                console.clear();
                console.log(chalk.italic("*HÃ¡ um mecÃ¢nico conhecido como o MÃ£o de broca nesse lugar!*"));
                return "mecanica"
            }
        }
    },
    mecanica: {
        descricao: async () => {
            console.log(chalk.italic("*VocÃª encontrou ele!*"));
            if (firsttime3) {
                console.log("OlÃ¡ viajante! Qual Ã© o seu nome?");
                nome = await prompt(">");
                console.clear();
                console.log("Ok, " + nome + "! Seu veÃ­culo estÃ¡ aqui? EstÃ¡ longe na estrada? " +
                    "Ok! Vamos nessa, eu dirijo o guincho.");
                firsttime3 = false;
            } else {
                console.log("Fala " + nome + "! Vamos retornar ao seu caminhÃ£o?");
            }
        },
        conexoes: {
            "voltar ao caminhao": () => {
                console.clear();
                console.log(chalk.italic("*Depois 12 minutos, vocÃª retorna ao seu caminhÃ£o, junto com o mecÃ¢nico pela estrada de guincho.*"));
                firsttime4 = true;
                firsttime5 = true;
                firsttime6 = true;
                horafinal = false;
                return "fora"
            },
            "sair": () => {
                console.clear();
                console.log("Tenha um bom dia, " + nome + "!");
                return "posto"
            }
        }

    }
};

let cenarioAtual = cenarios["menu"];
console.clear();

while (true) {

    await cenarioAtual.descricao();
    for (let chave in cenarioAtual.conexoes) {
        /*if(chave == "continuar" && firsttime2 == false){
            continue;
        } else*/ if (chave == "O (voltar ao posto)" && firsttime5 == true) {
            continue;
        } else if (chave == "diagnostico" && firsttime7 == false) {
            continue;
        } else if (chave == "checar o combustivel" && combustivel == true) {
            continue;
        } else if (chave == "verificar o motor" && motor == true) {
            continue;
        } else if (chave == "checar a caixa de cambio" && cambio == true) {
            continue;
        } else if (chave == "checar o carda" && carda == true) {
            continue;
        } else if (chave == "dirigir" && finalscene == true) {
            continue;
        }
        console.log("-", chave);
    }

    const comando = await prompt(">");
    if (!comando) {
        return;
    }

    const destino = cenarioAtual.conexoes[comando];
    if (destino) {
        cenarioAtual = cenarios[destino()];
    } else {
        console.clear();
        console.log(chalk.red("Comando invÃ¡lido no seu contexto!"));
    }
}

}